<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      lang="es">

    <h:head>
        <title>Entrada al Inventario | HomeCopy</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
        <h:outputStylesheet library="css" name="dashboardusuarios.css"/>
        <style>
            :root {
                --primary-light: #34495e;
                --secondary: #3498db;
                --success: #27ae60;
                --danger: #e74c3c;
                --warning: #f39c12;
                --light: #ecf0f1;
                --dark: #2c3e50;
                --gray: #95a5a6;
                --border: #bdc3c7;
            }

            body {
                font-family: 'Montserrat', sans-serif;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                margin: 0;
                padding: 0;
                min-height: 100vh;
            }

            /* Sidebar (manteniendo tus estilos) */
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 260px;
                height: 100vh;
                background: linear-gradient(180deg, #2c3e50, #34495e);
                color: white;
                padding: 20px 0;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                z-index: 1000;
            }

            .sidebar-header {
                text-align: center;
                margin-bottom: 30px;
                padding: 0 15px;
            }

            .sidebar-header img {
                max-width: 80px;
                margin-bottom: 10px;
            }

            .sidebar-header span {
                display: block;
                font-weight: 600;
                font-size: 14px;
                color: white;
            }

            .sidebar-menu a {
                display: flex;
                align-items: center;
                padding: 12px 15px;
                color: #ecf0f1;
                text-decoration: none;
                margin: 5px 0;
                border-radius: 6px;
                transition: all 0.3s ease;
            }

            .sidebar-menu a:hover,
            .sidebar-menu a.active {
                background-color: rgba(255,255,255,0.1);
                color: white;
            }

            .sidebar-menu i {
                width: 20px;
                margin-right: 10px;
                text-align: center;
            }

            .sidebar-footer {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 15px;
                text-align: center;
                border-top: 1px solid rgba(255,255,255,0.2);
                background-color: rgba(0,0,0,0.1);
            }

            /* Contenido Principal Modernizado */
            .main-content {
                margin-left: 280px;
                padding: 30px;
                min-height: 100vh;
            }

            @media (max-width: 768px) {
                .sidebar {
                    width: 100%;
                    height: auto;
                    position: relative;
                }
                .main-content {
                    margin-left: 0;
                    padding: 20px;
                }
            }

            /* Header de Página */
            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                padding-bottom: 15px;
                border-bottom: 2px solid var(--border);
            }

            .page-title {
                color: var(--dark);
                font-size: 2rem;
                font-weight: 700;
                margin: 0;
            }

            .page-subtitle {
                color: var(--gray);
                font-size: 1.1rem;
                margin-top: 5px;
            }

            /* Panel Modernizado */
            .modern-panel {
                background: white;
                border-radius: 15px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                border: none;
                margin-bottom: 30px;
                overflow: hidden;
            }

            .modern-panel .ui-panel-titlebar {
                background: linear-gradient(135deg, var(--primary), var(--primary-light));
                color: white;
                border: none;
                padding: 20px 25px;
                font-weight: 600;
                font-size: 1.2rem;
            }

            .modern-panel .ui-panel-content {
                padding: 25px;
            }

            /* Grid Modernizado */
            .modern-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 20px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: var(--dark);
            }

            /* Botón Modernizado */
            .modern-button {
                background: linear-gradient(135deg, var(--success), #219653);
                color: white;
                border: none;
                padding: 12px 30px;
                border-radius: 10px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.3s ease;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
            }

            .modern-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
            }

            /* Tabla Modernizada */
            .modern-table {
                background: white;
                border-radius: 15px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                overflow: hidden;
                margin-top: 20px;
            }

            .modern-table .ui-datatable-header {
                background: linear-gradient(135deg, var(--primary), var(--primary-light));
                color: white;
                border: none;
                padding: 20px 25px;
                font-weight: 600;
                font-size: 1.3rem;
            }

            .modern-table .ui-column-title {
                font-weight: 600;
                color: var(--dark);
            }

            .modern-table .ui-datatable-data tr {
                transition: background-color 0.3s ease;
            }

            .modern-table .ui-datatable-data tr:hover {
                background-color: #f8f9fa;
            }

            .modern-table .ui-datatable-data td {
                padding: 15px 10px;
                border-color: var(--border);
                vertical-align: middle;
            }

            .modern-table .ui-datatable-data tr:nth-child(even) {
                background-color: #fafafa;
            }

            /* Badges para la tabla */
            .stock-badge {
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 600;
                display: inline-block;
            }

            .stock-high {
                background: #d5f4e1;
                color: var(--success);
            }

            .stock-medium {
                background: #fff3cd;
                color: var(--warning);
            }

            .stock-low {
                background: #f8d7da;
                color: var(--danger);
            }

            /* Inputs Modernizados */
            .ui-inputfield, .ui-selectonemenu {
                width: 100% !important;
                padding: 12px 15px !important;
                border: 2px solid var(--border) !important;
                border-radius: 8px !important;
                font-size: 1rem !important;
                transition: all 0.3s ease !important;
            }

            .ui-inputfield:focus, .ui-selectonemenu:focus {
                border-color: var(--primary) !important;
                box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1) !important;
            }

            /* Paginador Modernizado */
            .modern-table .ui-paginator {
                background: #f8f9fa;
                border: none;
                padding: 15px;
                border-top: 1px solid var(--border);
            }

            .modern-table .ui-paginator .ui-paginator-page,
            .modern-table .ui-paginator .ui-paginator-prev,
            .modern-table .ui-paginator .ui-paginator-next {
                border-radius: 8px;
                margin: 0 2px;
                transition: all 0.3s ease;
            }

            .modern-table .ui-paginator .ui-paginator-page.ui-state-active {
                background: var(--primary);
                color: white;
            }

            /* Empty State */
            .empty-state {
                text-align: center;
                padding: 40px 20px;
                color: var(--gray);
            }

            .empty-state i {
                font-size: 3rem;
                margin-bottom: 15px;
                color: #d1d5db;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .page-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 15px;
                }

                .modern-grid {
                    grid-template-columns: 1fr;
                }

                .modern-table .ui-datatable-tablewrapper {
                    overflow-x: auto;
                }

                .main-content {
                    padding: 15px;
                }
            }


        </style>
    </h:head>

    <h:body>
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header" style="text-align:center;">
                <h:graphicImage library="img" name="download.png" alt="Logo"/>
                <h3 style="margin-top:10px;">HOMECOPY<br/>J&amp;D</h3>
            </div>

            <div class="sidebar-menu">
                <h:link outcome="/admin.xhtml"><i class="fas fa-home"></i><span>Dashboard</span></h:link>
                <h:link outcome="/administrador/inventario.xhtml" styleClass="active"><i class="fas fa-box"></i><span>Inventario</span></h:link>
                <h:link outcome="/administrador/categorias.xhtml"><i class="fas fa-tags"></i><span>Categorías</span></h:link>
                <h:link outcome="/administrador/usuarios.xhtml"><i class="fas fa-users"></i><span>Usuarios</span></h:link>
            </div>

            <div class="sidebar-footer">
                <div class="user-info" style="margin-bottom:1rem;">
                    <h4>Bienvenido</h4>
                    <strong>#{sessionScope.user}</strong>
                </div>

                <h:form>
                    <h:commandLink action="#{usuarioBean.cerrarSesion}" 
                                   style="display:block;text-align:center;background:linear-gradient(135deg,#dc3545,#c82333);
                                   color:white;padding:10px;border-radius:8px;text-decoration:none;font-weight:500;">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </h:commandLink>
                </h:form>
            </div>
        </div>

        <!-- Contenido Principal Modernizado -->
        <div class="main-content">
            <!-- Header de la Página -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">Gestión de Inventario</h1>
                    <p class="page-subtitle">Registrar nuevas entradas al inventario</p>
                </div>
            </div>

            <!-- Formulario de Entrada -->
            <h:form id="formEntrada">
                <p:growl id="msgs" showDetail="true" sticky="false" life="5000"/>

                <p:panel styleClass="modern-panel fade-in" header="Nueva Entrada al Inventario">
                    <div class="modern-grid">
                        <!-- PRODUCTO -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-cube"></i> Producto
                            </label>
                            <p:selectOneMenu value="#{entradaInventarioBean.entrada.idProducto}" 
                                             style="width:100%" 
                                             required="true"
                                             requiredMessage="Seleccione un producto">
                                <f:selectItem itemLabel="Seleccione un producto" itemValue=""/>
                                <f:selectItems value="#{entradaInventarioBean.listaProductos}" var="p"
                                               itemLabel="#{p.nombre}" itemValue="#{p.id}"/>
                            </p:selectOneMenu>
                        </div>

                        <!-- CANTIDAD -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-boxes"></i> Cantidad
                            </label>
                            <p:inputText value="#{entradaInventarioBean.entrada.cantidad}" 
                                         required="true"
                                         requiredMessage="Ingrese la cantidad"
                                         placeholder="Ej: 100"/>
                        </div>

                        <!-- PRECIO -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-dollar-sign"></i> Precio Unitario
                            </label>
                            <p:inputText value="#{entradaInventarioBean.entrada.precio}" 
                                         required="true"
                                         requiredMessage="Ingrese el precio"
                                         placeholder="Ej: 25.50"/>
                        </div>

                        <!-- CC USUARIO -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-id-card"></i> Cédula Usuario
                            </label>
                            <p:inputText value="#{entradaInventarioBean.entrada.ccUsuario}" 
                                         required="true"
                                         requiredMessage="Ingrese la cédula"
                                         placeholder="Ej: 123456789"/>
                        </div>

                        <!-- FECHA -->
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar-alt"></i> Fecha de Entrada
                            </label>
                            <p:datePicker value="#{entradaInventarioBean.entrada.fechaEntrada}" 
                                          showTime="true"
                                          hourFormat="24"
                                          required="true"
                                          pattern="yyyy-MM-dd HH:mm"
                                          style="width:100%"
                                          placeholder="Seleccione fecha y hora"/>
                        </div>
                    </div>

                    <p:commandButton value="Registrar Entrada"
                                     actionListener="#{entradaInventarioBean.registrarEntrada}"
                                     update="msgs formEntrada :tablaEntradas"
                                     process="@form"
                                     icon="pi pi-save"
                                     styleClass="modern-button"/>
                    <p:button value="Cancelar" outcome="/administrador/inventario.xhtml" styleClass="btn-secondary" icon="pi pi-times"/>
                </p:panel>
            </h:form>

            <!-- Tabla de Entradas Registradas -->
            <div class="fade-in">
                <p:dataTable  id="tablaEntradas"
                              value="#{entradaInventarioBean.listaEntradas}"
                              var="e"
                              paginator="true"
                              rows="10"
                              styleClass="modern-table"
                              emptyMessage="No hay entradas registradas.">

                    <f:facet name="header">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Historial de Entradas Registradas</span>
                            <span class="ui-column-title" style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                                <i class="fas fa-history"></i> Total: #{entradaInventarioBean.listaEntradas.size()} registros
                            </span>
                        </div>
                    </f:facet>

                    <p:column headerText="ID Entrada" style="width: 100px;">
                        <h:outputText value="#{e.id}" style="font-weight: 600; color: var(--primary);"/>
                    </p:column>

                    <p:column headerText="Producto" filterBy="#{e.nombreProducto}">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-cube" style="color: var(--primary);"></i>
                            <div>
                                <div style="font-weight: 600;">#{e.nombreProducto}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">ID: #{e.idProducto}</div>
                            </div>
                        </div>
                    </p:column>

                    <p:column headerText="Cantidad" style="text-align: center; width: 120px;">
                        <span class="stock-badge #{e.cantidad > 50 ? 'stock-high' : e.cantidad > 20 ? 'stock-medium' : 'stock-low'}">
                            #{e.cantidad} unidades
                        </span>
                    </p:column>

                    <p:column headerText="Stock Actual" style="text-align: center; width: 120px;">
                        <h:outputText value="#{e.stockActual}" style="font-weight: 600;"/>
                    </p:column>

                    <p:column headerText="Precio" style="text-align: right; width: 130px;">
                        <h:outputText value="#{e.precio}">
                            <f:convertNumber type="currency" currencySymbol="$"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Fecha Entrada" style="width: 180px;">
                        <h:outputText value="#{e.fechaEntrada}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Usuario" style="width: 140px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-user" style="color: var(--gray);"></i>
                            <h:outputText value="#{e.ccUsuario}"/>
                        </div>
                    </p:column>

                </p:dataTable>
            </div>
        </div>

    </h:body>
</html>